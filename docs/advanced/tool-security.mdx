---
title: Tool Security
description: Security guidance for agent tools and function calls.
slug: /features/tool-security
---

# Tool Security

Agent tools (functions) can access databases, files, and external APIs. This page outlines how to secure tools when routing requests through KoreShield.

## Threat Model

- Prompt injection that attempts to call unsafe tools
- Exfiltration via tools that access sensitive data
- Tool misuse through unvalidated arguments
- Cross-tenant data leakage in multi-tenant systems

## Core Principles

- **Allowlist tools only:** expose a minimal, explicit set of tools
- **Validate inputs:** schema validation plus business rules
- **Least privilege:** tools should only access required data
- **Audit everything:** log tool calls, arguments, and outcomes

## Recommended Controls

### 1. Tool Allowlisting

Keep a small list of approved tools. Reject any tool name that is not explicitly allowed.

### 2. Argument Validation

- Use strict JSON schema validation
- Enforce length limits and safe character sets
- Reject high-risk patterns (e.g., SQL injection sequences)

### 3. Output Filtering

- Strip secrets, tokens, and PII before returning results
- Apply response safety checks on tool output

### 4. Rate Limits

- Apply per-user or per-tenant limits
- Use Redis-backed rate limiting for consistency

### 5. Human-in-the-Loop

For high-impact actions (e.g., deleting data), require manual approval.

## Example Tool Guard (TypeScript)

```typescript
const allowedTools = new Set(["search_database", "get_user_profile"]);

function validateToolCall(name: string, args: Record<string, unknown>) {
  if (!allowedTools.has(name)) {
    throw new Error("Tool not allowed");
  }

  if (typeof args.query !== "string" || args.query.length > 200) {
    throw new Error("Invalid query");
  }
}
```

## Example Tool Guard (Python)

```python
allowed_tools = {"search_database", "get_user_profile"}

def validate_tool_call(name: str, args: dict) -> None:
    if name not in allowed_tools:
        raise ValueError("Tool not allowed")

    query = args.get("query", "")
    if not isinstance(query, str) or len(query) > 200:
        raise ValueError("Invalid query")
```

## Policy Alignment

- Set `default_action: block` for high-risk environments
- Use `sensitivity: high` when tools access sensitive systems
- Enable sanitization and detection to reduce injection risk

```yaml
security:
  sensitivity: high
  default_action: block
  features:
    sanitization: true
    detection: true
    policy_enforcement: true
```

## Observability

- Log each tool call with request ID and user ID
- Review security events for repeated tool misuse
- Alert on elevated tool error or block rates

## Related Docs

- Security overview in [../features/security.mdx](../features/security.mdx)
- Policies in [../configuration/policies.mdx](../configuration/policies.mdx)
